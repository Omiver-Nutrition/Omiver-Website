{% extends 'dashboard/base.html' %}
{% load static %}
{% load component_tags %}

{% block inner_styles %}
<link rel="stylesheet" href="{% static 'dashboard/profile/style.css' %}" />
{% endblock %}

{% block dashboard_content %}
<div id="info-block">
    <div class="desacription-info-block">
        <h4>Hello {{ name }}!</h4>
        <p>Here you can manage your task, set preferences and updates.</p>
    </div>
    <img class="cartoon" src="{% static 'dashboard/profile/banner.svg' %}" />
    <div class="ticket-info-block">
        <img src="{% static 'dashboard/profile/last_test.svg' %}" />
        <span>
            <h4>Latest Test</h4>
            <p>20 Apr, 2025</p>
        </span>
    </div>
    <div class="ticket-info-block">
        <img src="{% static 'dashboard/profile/next_test.svg' %}" />
        <span>
            <h4>Next Test</h4>
            <p>21 Apr, 2025</p>
        </span>
    </div>
</div>

<div class="dashboard-container">
    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn"  onclick="location.href='/demo/select'">
            <span class="btn-icon"><img src="{% static 'dashboard/profile/change_profile.svg' %}" alt="Change Profile" /></span>
            <div class="text-group">
                <span class="btn-text-secondary">Change Profile</span>
                <span class="btn-text">Try other Profiles</span>
            </div>
        </button>
        
        <button class="action-btn" hx-get="/chatbot" hx-target="#main-content">
            <span class="btn-icon"><img src="{% static 'dashboard/profile/chatbot.svg' %}" alt="Chatbot" /></span>
            <div class="text-group">
                <span class="btn-text-secondary">Quick FaqAnswers</span>
                <span class="btn-text">Interact with Chatbot</span>
            </div>
        </button>
        
        <button class="action-btn" hx-get="/improve" hx-target="#main-content">
            <span class="btn-icon"><img src="{% static 'dashboard/profile/improve.svg' %}" alt="Improve" /></span>
            <div class="text-group">
                <span class="btn-text-secondary">Give Feedback</span>
                <span class="btn-text">How we can improve?</span>
            </div>
        </button>
        
        <button class="action-btn" hx-get="/support" hx-target="#main-content">
            <span class="btn-icon"><img src="{% static 'dashboard/profile/support.svg' %}" alt="Support" /></span>
            <div class="text-group">
                <span class="btn-text-secondary">Help Center</span>
                <span class="btn-text">Contact & Support</span>
            </div>
        </button>
    </div>

    <!-- Main Content -->
    <div id="main-content" class="main-content">
        <div class="content-grid">
            <!-- Profile Section -->
            <div class="profile-section">
                <div class="profile-header">
                    <h2>Profile</h2>
                </div>
                <div class="profile-card">
                    <div class="profile-info">
                        <div class="profile-top">
                            <div class="profile-avatar">
                                <img class="profile-pic" src="{% static 'demo/select/' %}{{name}}.png" style="border: 3px solid {{ colour }};"/>
                            </div>
                            <div class="profile-basic">
                                <p>{{name}}</p>
                                <p>{{age}} Years Old</p>
                            </div>
                        </div>
                        <div class="profile-details">
                            <div class="profile-stats">
                                <div class="stat">
                                    <span class="stat-label">Ethnicity</span>
                                    <span class="stat-value">{{ethnicity}}</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Allergies</span>
                                    <span class="stat-value">{{allergies}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="profile-details">
                            <div class="profile-stats">
                                <div class="stat">
                                    <span class="stat-label">Sport:</span>
                                    <span class="stat-value">{{sport}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="profile-image">
                        <img src="{% static 'demo/select/' %}{{name}}.png" alt="Workout">
                    </div>
                </div>
            </div>

            <!-- Highlights Chart -->
            <div class="highlights-section">
                <div class="section-header">
                    <h2>Highlights</h2>
                    <select class="time-filter" hx-get="/highlights" hx-trigger="change" hx-target="#highlights-chart">
                        <option value="7">Last 30 Days</option>
                        <option value="30">Last 60 Days</option>
                        <option value="90">Last 90 Days</option>
                    </select>
                </div>
                <div id="highlights-chart" class="chart-container">
                    <canvas id="progressChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Goals Section -->
            <div class="goals-section">
                <div class="goal-card fitness-goal">
                    <div class="goal-icon"><img src="{% static 'dashboard/profile/fitness_goal.svg' %}" alt="Fitness Goal" /></div>
                    <div class="goal-content">
                        <h3>Fitness Goal</h3>
                        <p>{{ goal.fitness }}</p>
                    </div>
                </div>
                
                <div class="goal-card nutrition-goal">
                    <div class="goal-icon"><img src="{% static 'dashboard/profile/nutrition_goal.svg' %}" alt="Nutrition Goal" /></div>
                    <div class="goal-content">
                        <h3>Nutrition Goal</h3>
                        <p>{{ goal.nutrition }}</p>
                    </div>
                </div>
            </div>

            <!-- Biomarker Overview -->
            <div class="biomarker-section">
                <h2>Biomarker Overview</h2>
                <div class="biomarker-grid">
                    <div class="biomarker-category">
                        <div class="category-header">
                            <div class="category-indicator orange"></div>
                            <span class="category-percentage">23%</span>
                            <span class="category-label">in range</span>
                        </div>
                        <div class="biomarker-list">
                            <div class="biomarker-item">
                                <span class="marker-name">Hexanoic Acid</span>
                                <span class="marker-value">0</span>
                            </div>
                            <div class="biomarker-item">
                                <span class="marker-name">Glutamine</span>
                                <span class="marker-value">0</span>
                            </div>
                            <div class="biomarker-item">
                                <span class="marker-name">Lycopene</span>
                                <span class="marker-value">0</span>
                            </div>
                            <div class="biomarker-item">
                                <span class="marker-name">Timsol</span>
                                <span class="marker-value">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="biomarker-category">
                        <div class="biomarker-list">
                            <div class="biomarker-item">
                                <span class="marker-name">Histidine</span>
                                <span class="marker-value">0</span>
                            </div>
                            <div class="biomarker-item">
                                <span class="marker-name">Leucine</span>
                                <span class="marker-value">0</span>
                            </div>
                            <div class="biomarker-item">
                                <span class="marker-name">Lactic Acid</span>
                                <span class="marker-value">0</span>
                            </div>
                            <div class="biomarker-item">
                                <span class="marker-name">Glucose</span>
                                <span class="marker-value">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="biomarker-category">
                        <div class="biomarker-list">
                            <div class="biomarker-item">
                                <span class="marker-name">Carnitine</span>
                                <span class="marker-value">0</span>
                            </div>
                            <div class="biomarker-item">
                                <span class="marker-name">Magnesium</span>
                                <span class="marker-value">0</span>
                            </div>
                            <div class="biomarker-item">
                                <span class="marker-name">Vitamin D</span>
                                <span class="marker-value">0</span>
                            </div>
                            <div class="biomarker-item">
                                <span class="marker-name">Vitamin C</span>
                                <span class="marker-value">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="recommendations-section">
                <div class="recommendation-card meal-plan">
                    <div class="rec-header">
                        <div class="rec-icon">🍽️</div>
                        <h3>Today Recommendation - Meal Plan</h3>
                    </div>
                    <div class="meal-schedule" hx-get="/meal-plan" hx-trigger="revealed" hx-target="this">
                        {% for type, meal in food_log.items %}
                        <div class="meal-item">
                            <strong>{{ type|capfirst }}:</strong>
                            <p>{{ meal }}</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <div class="recommendation-card exercise-plan">
                    <div class="rec-header">
                        <div class="rec-icon">💪</div>
                        <h3>Today Recommendation - Exercise Plan</h3>
                    </div>
                    <div class="exercise-schedule" hx-get="/exercise-plan" hx-trigger="revealed" hx-target="this">
                        <div class="exercise-item">
                            <strong>Warm:</strong>
                            <p>Full-body light circuit, hand-eye coordination training</p>
                        </div>
                        <div class="exercise-item">
                            <strong>Part 1:</strong>
                            <p>HIIT circuit: 3 sets of 10-12 reps</p>
                        </div>
                        <div class="exercise-item">
                            <strong>Break:</strong>
                            <p>Take 10 minutes break and rest</p>
                        </div>
                        <div class="exercise-item">
                            <strong>Part 2:</strong>
                            <p>Jumping jacks with alternating arms: 3 sets of 10-12 reps</p>
                        </div>
                        <div class="exercise-item">
                            <strong>Break:</strong>
                            <p>Take 10 minutes break and rest</p>
                        </div>
                        <div class="exercise-item">
                            <strong>Part 3:</strong>
                            <p>Fast jumps with alternating legs: 3 sets of 10-12 reps</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monitoring Progress -->
            <div class="monitoring-section">
                <h2>Monitoring Progress</h2>
                <p>Previous data were checked for 6 months and have seen improvement in 5 biomarker results</p>
                <div class="progress-timeline" hx-get="/progress-data" hx-trigger="revealed" hx-target="this">
                    <div class="timeline-months">
                        <div class="month-indicator active" data-month="Jan">Jan</div>
                        <div class="month-indicator active" data-month="Feb">Feb</div>
                        <div class="month-indicator active" data-month="Mar">Mar</div>
                        <div class="month-indicator active" data-month="Apr">Apr</div>
                        <div class="month-indicator" data-month="May">May</div>
                        <div class="month-indicator" data-month="Jun">Jun</div>
                        <div class="month-indicator" data-month="Jul">Jul</div>
                        <div class="month-indicator" data-month="Aug">Aug</div>
                        <div class="month-indicator" data-month="Sep">Sep</div>
                        <div class="month-indicator" data-month="Oct">Oct</div>
                        <div class="month-indicator" data-month="Nov">Nov</div>
                        <div class="month-indicator" data-month="Dec">Dec</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Simple chart rendering
document.addEventListener('DOMContentLoaded', function() {
    const canvas = document.getElementById('progressChart');
    if (canvas) {
        const ctx = canvas.getContext('2d');
        
        // Sample chart data
        const data = [20, 35, 30, 45, 40, 55, 50];
        const labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
        
        // Simple line chart
        ctx.strokeStyle = '#ff6b6b';
        ctx.lineWidth = 2;
        ctx.beginPath();
        
        const width = canvas.width - 60;
        const height = canvas.height - 40;
        const stepX = width / (data.length - 1);
        const maxY = Math.max(...data);
        
        data.forEach((point, index) => {
            const x = 30 + index * stepX;
            const y = height - (point / maxY) * (height - 20) + 20;
            
            if (index === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        });
        
        ctx.stroke();
    }
});
</script>

{% component "demo_modal" / %}
{% endblock %}